# 转盘伺服系统 IO 映射表

## 系统概述

**任务要求**：
1. 系统上电后，转盘正转5s进行自检，而后反转回到原点
2. 按下启动按钮，等待人工将料块放到转盘原点处工位，而后正转动90°，检测2s料块是否空芯：
   - 若是空芯料块，则转动90°进行装配，若料井内没有料块，则待人工投入后装配，装配完成后，转动180°回到原点处停止
   - 若是有芯料块，则转动270°回到原点处停止
3. 再次按下启动按钮后，设备可再次运行

---

## 输入地址（I区）

| 地址 | 符号名称 | 传感器编号 | 功能说明 | 正常状态 | 触发状态 |
|------|----------|-----------|----------|----------|----------|
| **%I10.0** | 转盘原点 | 检测1 | 转盘回到原点位置 | FALSE | TRUE（到位） |
| **%I10.1** | 料块检测 | 检测2 | 原点工位检测到料块 | FALSE | TRUE（有料） |
| **%I10.2** | 料芯检测 | 检测3 | 检测料块是否有芯 | FALSE(空芯) | TRUE（有芯） |
| **%I10.3** | 料芯井检测 | 检测4 | 料芯井内是否有料芯 | FALSE(无) | TRUE（有料芯） |
| **%I10.4** | 料块固定 | 检测5 | 工件固定气缸到位 | FALSE | TRUE（固定） |
| **%I10.5** | 压料柱回位 | 检测6 | 压料柱回到上位 | FALSE | TRUE（回位） |
| **%I10.6** | 压料柱到位 | 检测7 | 压料柱下压到位 | FALSE | TRUE（到位） |
| **%I10.7** | 临时停位 | 检测8 | 临时库位检测 | FALSE | TRUE（有料） |

---

## 输出地址（Q区）

| 地址 | 符号名称 | 控制编号 | 功能说明 | OFF状态 | ON状态 |
|------|----------|---------|----------|---------|--------|
| **%Q4.2** | 工件固定气缸 | 控制3 | 固定工位上的料块 | 松开 | 夹紧 |
| **%Q4.3** | 料块推出气缸 | 控制4 | 将料芯推入料块 | 缩回 | 伸出 |
| **%Q4.4** | 压料柱气缸 | 控制5 | 压装动作 | 上升 | 下压 |

## 伺服轴控制（工艺对象）

| 信号 | 数据类型 | 方向 | 说明 |
|------|----------|------|------|
| 轴启动定位 | Bool | OUT | 触发MC_MoveAbsolute.Execute |
| 轴目标位置 | LReal | OUT | MC_MoveAbsolute.Position |
| 轴定位完成 | Bool | IN | MC_MoveAbsolute.Done |

---

## 伺服轴接口（PROFIdrive）

| 地址 | 符号名称 | 数据类型 | 功能说明 |
|------|----------|----------|----------|
| **%I124.0** | PositioningAxis_1_Actor_Interface_In | PD_TEL3_IN | 伺服轴输入接口 |
| **%Q78.0** | PositioningAxis_1_Actor_Interface_Out | PD_TEL3_OUT | 伺服轴输出接口 |

---

## 工位布局说明

```
           工位4(270)
           未使用
              │
              │
工位3(180°)───┼───工位1(0°/原点)
  装配工位    │      上料工位
              │
              │
           工位4(90°)
           （检测工位）
```

**转盘旋转说明**：
- 正转（DIR=0）：顺时针方向，0° → 90° → 180° → 270°
- 反转（DIR=1）：逆时针方向，270° → 180° → 90° → 0°
- 90°对应的脉冲数需根据实际伺服参数计算

---

## 内部标志位（M区）

### 系统状态标志

| 地址 | 符号名称 | 功能说明 | 备注 |
|------|----------|----------|------|
| **M0.0** | b系统上电 | 系统主控开关 | 上电后置1 |
| **M0.1** | b自检完成 | 自检流程完成标志 | 自检完成后置1 |
| **M0.2** | b工作运行 | 主工作流程运行中 | 启动后置1，流程结束清0 |
| **M0.3** | b回原点状态 | 正在执行回原点 | 回原点期间置1 |

### 流程步骤标志

| 地址 | 符号名称 | 功能说明 | 备注 |
|------|----------|----------|------|
| **M1.0** | b等待放料 | 等待人工放料 | Step 1 |
| **M1.1** | b转90到检测 | 正转90°到检测工位 | Step 2 |
| **M1.2** | b检测中 | 正在检测料块芯（2s） | Step 3 |
| **M1.3** | b空芯处理 | 空芯料块处理流程 | Step 4a |
| **M1.4** | b有芯处理 | 有芯料块处理流程 | Step 4b |
| **M1.5** | b装配中 | 正在进行装配 | Step 5 |
| **M1.6** | b回原点 | 正转回原点 | Step 6 |

### 中间变量

| 地址 | 符号名称 | 功能说明 | 备注 |
|------|----------|----------|------|
| **M2.0** | b料块是空芯 | 检测结果：空芯料块 | 检测完成后锁存 |
| **M2.1** | b装配完成 | 装配动作完成 | 装配后置1 |
| **M2.2** | b等待料芯 | 等待人工投入料芯 | 料芯井无料时 |

---

## 定时器（T区）

| 编号 | 符号名称 | 设定值 | 功能说明 |
|------|----------|--------|----------|
| **T1** | t自检正转 | 5.0s | 自检阶段正转时间 |
| **T2** | t检测延时 | 2.0s | 料块芯检测时间 |
| **T3** | t装配延时 | 1.0s | 装配动作保持时间 |
| **T4** | t脉冲输出 | - | 脉冲输出定时（角度控制） |

---

## 绝对位置控制（校准值）

### 绝对位移 vs 相对位移

| 类型 | 说明 | 特点 |
|------|------|------|
| **绝对位移** | 目标位置相对于原点(0°)的绝对脉冲数 | 位置精确，不累积误差 |
| **相对位移** | 从当前位置移动的脉冲数 | 可能累积误差 |

**本程序使用绝对位移控制**

### 转盘角度脉冲对应（点动校准实测值）

| 角度 | 绝对位置(脉冲) | 工位说明 |
|------|----------------|----------|
| **0°** | 0 | 原点/上料工位 |
| **45°** | 18000 | - |
| **90°** | 36000 | 检测工位 |
| **180°** | 70000 | 装配工位 |
| **270°** | 104000 | 过渡位置 |
| **360°** | 140000 | 回到原点(一圈) |

### 校准方式

```
1. 手动点动转盘到达需要的工位角度
2. 记录此时伺服驱动器显示的位置值(脉冲数)
3. 将该值写入程序中对应的常量
4. 使用绝对位移方式定位
```

### 流程中的绝对位置

| 流程步骤 | 起始位置 | 目标位置 | 移动量 |
|----------|----------|----------|--------|
| 放料→检测 | 0 | 36000 | 36000 |
| 检测→装配(空芯) | 36000 | 70000 | 34000 |
| 装配→原点(空芯) | 70000 | 140000 | 70000 |
| 检测→原点(有芯) | 36000 | 140000 | 104000 |

---

## 流程状态机

### 自检流程（上电执行一次）

```
State 0: 初始化
    ↓
State 1: 正转5s自检 (T1计时)
    ↓ T1.Q=TRUE
State 2: 反转回原点
    ↓ I10.0(转盘原点)=TRUE
State 3: 自检完成 → M0.1置位
```

### 主工作流程

```
State 10: 等待启动按钮 + 自检完成
    ↓ 启动按钮↑ AND M0.1
State 11: 等待人工放料
    ↓ I10.1(料块检测)=TRUE
State 12: 正转90°到检测工位
    ↓ 脉冲计数完成
State 13: 检测2s (T2计时)
    ↓ T2.Q=TRUE
    ├── I10.2=FALSE(空芯) → State 14a
    └── I10.2=TRUE(有芯) → State 14b

State 14a: 空芯料块 - 正转90°到装配工位
    ↓ 脉冲计数完成
State 15: 检测料芯井
    ├── I10.3=TRUE(有料芯) → State 16
    └── I10.3=FALSE(无料芯) → State 15(等待投入)
State 16: 执行装配
    ↓ 装配完成
State 17: 正转180°回原点
    ↓ I10.0=TRUE
State 18: 流程完成，等待再次启动

State 14b: 有芯料块 - 正转270°回原点
    ↓ I10.0=TRUE
State 18: 流程完成，等待再次启动
```

---

## 安全互锁

1. **回原点互锁**：执行回原点时禁止其他流程
2. **自检互锁**：自检未完成前禁止启动主流程
3. **工件固定互锁**：转盘转动前必须确认工件已固定（检测5）
4. **压料柱互锁**：压料柱动作前必须确认料块在位

---

## 硬件接线说明

### 输入接线（24V DC）

```
传感器接线（接近开关/光电开关）：
  - PNP型：信号线直接接PLC输入端
  - NPN型：需要上拉电阻或使用漏型输入
  - 回路：24V+ → 传感器 → PLC输入端
```

### 输出接线

```
伺服驱动器接线（转盘）：
  - Q4.0(CP) → 驱动器PUL+
  - Q4.1(DIR) → 驱动器DIR+
  - Q4.5(使能) → 驱动器ENA+
  - PLC COM → 驱动器PUL-/DIR-/ENA-

气缸电磁阀接线：
  - Q4.2~Q4.4 → 24V电磁阀线圈
  - 电磁阀另一端 → 24V-
```

---

## TIA Portal 配置步骤

### 1. 创建项目
1. 打开 TIA Portal V17
2. 新建项目，选择 CPU 1511-1 PN（或实际型号）
3. 添加 DI/DO 模块

### 2. 创建符号表
1. 在 **PLC tags** 中添加上述输入/输出地址
2. 按本文档的符号名称和地址配置

### 3. 创建程序块
1. **FB1 "转盘伺服控制"**：主控制逻辑
2. **DB1**：FB1 的实例数据块
3. **OB1**：主程序，调用 FB1

### 4. 下载测试
1. 编译无错误
2. 下载硬件配置和程序
3. 切换到 RUN 模式
4. 使用监控表观察变量

---

## 调试建议

### 首次调试步骤

1. **测试传感器**
   - 在监控模式下观察 I10.0~I10.7
   - 手动触发每个传感器，确认输入变化

2. **测试转盘运动**
   - 手动使能转盘（Q4.5=1）
   - 测试正转：Q4.1=0, 输出脉冲
   - 测试反转：Q4.1=1, 输出脉冲
   - 确认方向正确

3. **测试气缸动作**
   - 逐个测试 Q4.2~Q4.4
   - 确认动作方向和到位检测

4. **测试自检流程**
   - 上电后观察转盘正转5s
   - 确认自动反转并停在原点

5. **测试主流程**
   - 放料 → 转90° → 检测 → 分支处理

### 常见故障排查

| 故障现象 | 可能原因 | 解决方法 |
|---------|---------|---------|
| 转盘不转 | 使能信号未输出 | 检查 Q4.5 输出 |
| 回不到原点 | 原点传感器故障 | 检查 I10.0 信号 |
| 检测不准确 | 检测时间不足 | 调整 T2 延时 |
| 装配失败 | 料芯推出不到位 | 检查气缸行程和压力 |
| 角度不准 | 脉冲数计算错误 | 重新校准脉冲当量 |

---

## 参考资料

- S7-1500 PTO（脉冲串输出）配置
- 伺服驱动器参数设置
- 工位布局图纸

# 转盘伺服系统流程图

## 系统整体流程

```
┌─────────────────────────────────────────────────────────────────┐
│                         系统上电                                 │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    阶段1: 上电自检                               │
│  ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐      │
│  │ 初始化  │───▶│ 正转5s  │───▶│反转回原点│───▶│自检完成 │      │
│  └─────────┘    └─────────┘    └─────────┘    └─────────┘      │
│                                      ▲                          │
│                                      │                          │
│                              I10.0(原点)=ON                      │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    等待启动按钮                                  │
└─────────────────────────────────────────────────────────────────┘
                              │
                        启动按钮按下
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    阶段2: 主工作流程                             │
└─────────────────────────────────────────────────────────────────┘
```

---

## 主工作流程详细

```
                    ┌─────────────┐
                    │ 等待人工放料 │
                    │  (原点工位)  │
                    └──────┬──────┘
                           │
                    I10.1(料块)=ON
                           │
                           ▼
                    ┌─────────────┐
                    │  正转 90°   │
                    │ 到检测工位  │
                    └──────┬──────┘
                           │
                           ▼
                    ┌─────────────┐
                    │  检测 2秒   │
                    │ 料块是否空芯│
                    └──────┬──────┘
                           │
         ┌─────────────────┴─────────────────┐
         │                                   │
    I10.2=OFF                           I10.2=ON
    (空芯料块)                          (有芯料块)
         │                                   │
         ▼                                   ▼
┌─────────────┐                     ┌─────────────┐
│  正转 90°   │                     │  正转 270°  │
│ 到装配工位  │                     │  回到原点   │
└──────┬──────┘                     └──────┬──────┘
       │                                   │
       ▼                                   │
┌─────────────┐                            │
│ 检测料芯井  │                            │
│ I10.3       │                            │
└──────┬──────┘                            │
       │                                   │
  ┌────┴────┐                              │
  │         │                              │
有料芯    无料芯                            │
I10.3=ON  I10.3=OFF                         │
  │         │                              │
  │    等待人工投入                         │
  │         │                              │
  └────┬────┘                              │
       │                                   │
       ▼                                   │
┌─────────────┐                            │
│  执行装配   │                            │
│ 推料+压装  │                            │
└──────┬──────┘                            │
       │                                   │
  压料柱到位                                │
  I10.6=ON                                 │
       │                                   │
       ▼                                   │
┌─────────────┐                            │
│ 装配延时1s  │                            │
└──────┬──────┘                            │
       │                                   │
       ▼                                   │
┌─────────────┐                            │
│  正转 180°  │                            │
│  回到原点   │                            │
└──────┬──────┘                            │
       │                                   │
       └───────────────┬───────────────────┘
                       │
                       ▼
                ┌─────────────┐
                │  到达原点   │
                │ I10.0=ON   │
                └──────┬──────┘
                       │
                       ▼
                ┌─────────────┐
                │  流程完成   │
                │ 松开工件   │
                └──────┬──────┘
                       │
                       ▼
                ┌─────────────┐
                │等待再次启动 │
                └─────────────┘
```

---

## 状态机转换图

```
                                    停止按钮
                                       │
                                       ▼
    ┌────────────────────────────── Step 0 ◀────────────────────────┐
    │                              等待启动                          │
    │                                  │                             │
    │                           启动按钮↑                            │
    │                                  │                             │
    │                                  ▼                             │
    │                              Step 10                           │
    │                              等待放料                          │
    │                                  │                             │
    │                           I10.1(料块)=ON                       │
    │                                  │                             │
    │                                  ▼                             │
    │                              Step 20                           │
    │                            转90°检测                           │
    │                                  │                             │
    │                            脉冲计数完成                         │
    │                                  │                             │
    │                                  ▼                             │
    │                              Step 30                           │
    │                            检测2秒                             │
    │                                  │                             │
    │              ┌───────────────────┴───────────────────┐         │
    │              │                                       │         │
    │         空芯(I10.2=OFF)                        有芯(I10.2=ON)   │
    │              │                                       │         │
    │              ▼                                       ▼         │
    │          Step 40                                 Step 80       │
    │        转90°装配                               转270°回原点     │
    │              │                                       │         │
    │              ▼                                       │         │
    │          Step 50                                     │         │
    │         等待料芯                                     │         │
    │              │                                       │         │
    │       I10.3(料芯井)=ON                               │         │
    │              │                                       │         │
    │              ▼                                       │         │
    │          Step 60                                     │         │
    │           装配                                       │         │
    │              │                                       │         │
    │        I10.6(压料柱到位)+延时                         │         │
    │              │                                       │         │
    │              ▼                                       │         │
    │          Step 70                                     │         │
    │       转180°回原点                                    │         │
    │              │                                       │         │
    │              └───────────┬───────────────────────────┘         │
    │                          │                                     │
    │                    I10.0(原点)=ON                               │
    │                          │                                     │
    │                          ▼                                     │
    │                      Step 90 ──────────────────────────────────┘
    │                      流程完成
    │
    └──────────────────────────────────────────────────────────────────
```

---

## 角度与脉冲对应关系（绝对位置）

```
                    90° (36000)
                   检测工位(Step 30)
                         │
                         │
          ┌──────────────┼──────────────┐
          │              │              │
          │      ┌───────┴───────┐      │
          │      │               │      │
180° ─────┼──────│    转 盘     │──────┼───── 0° (0)
(70000)   │      │               │      │    原点/上料
装配工位   │      └───────────────┘      │    (Step 10)
(Step 50-60)                            │
          │                             │
          └─────────────────────────────┘
                         │
                        270° (104000)
                   (过渡位置)
                   有芯料块经过
```

### 校准脉冲值（点动实测）

| 角度 | 绝对位置(脉冲) | 说明 |
|------|----------------|------|
| 0° | **0** | 原点 |
| 45° | **18000** | 参考点 |
| 90° | **36000** | 检测工位 |
| 180° | **70000** | 装配工位 |
| 270° | **104000** | 过渡位置 |
| 360° | **140000** | 一圈回原点 |

### 绝对位移 vs 相对位移

| 类型 | 定义 | 本程序 |
|------|------|--------|
| **绝对位移** | 目标位置相对于原点的绝对脉冲数 | ✅ 使用 |
| **相对位移** | 从当前位置移动的脉冲数 | ❌ 不使用 |

**转动路径说明（绝对定位）：**

| 操作 | 起始位置 | 目标位置 | 移动量 |
|------|----------|----------|--------|
| 放料→检测 | 0 | 36000 | 36000 |
| 检测→装配(空芯) | 36000 | 70000 | 34000 |
| 装配→原点(空芯) | 70000 | 140000 | 70000 |
| 检测→原点(有芯) | 36000 | 140000 | 104000 |

---

## IO 地址映射表

### 输入信号 (I10.x)

| 地址 | 符号 | 功能 | 检测编号 |
|------|------|------|---------|
| %I10.0 | 转盘原点 | 转盘原点位置 | 检测1 |
| %I10.1 | 料块检测 | 原点工位料块 | 检测2 |
| %I10.2 | 料芯检测 | 料块是否有芯 | 检测3 |
| %I10.3 | 料芯井检测 | 料芯井有料芯 | 检测4 |
| %I10.4 | 料块固定 | 工件固定到位 | 检测5 |
| %I10.5 | 压料柱回位 | 压料柱上位 | 检测6 |
| %I10.6 | 压料柱到位 | 压料柱下压到位 | 检测7 |
| %I10.7 | 临时停位 | 临时库位 | 检测8 |

### 输出信号 (Q4.x)

| 地址 | 符号 | 功能 | 控制编号 |
|------|------|------|---------|
| %Q4.0 | 转盘CP | 脉冲输出 | 控制1 |
| %Q4.1 | 转盘DIR | 方向(0=正,1=反) | 控制2 |
| %Q4.2 | 工件固定气缸 | 固定工件 | 控制3 |
| %Q4.3 | 料块推出气缸 | 推出料芯 | 控制4 |
| %Q4.4 | 压料柱气缸 | 压装动作 | 控制5 |
| %Q4.5 | 转盘使能 | 驱动器使能 | - |

---

## 气缸动作时序

```
时间轴 ──────────────────────────────────────────────────────────────▶

工件固定气缸    ____┌──────────────────────────────────────────────┐____
(Q4.2)              │◀──── 从检测到回原点全程固定 ─────────────────▶│

料块推出气缸    ________________________┌──────────┐____________________
(Q4.3)                                  │◀ 装配时 ▶│

压料柱气缸      ________________________┌──────────┐____________________
(Q4.4)                                  │◀ 装配时 ▶│
                                        ▲
                                        │
                                   I10.6到位后
                                   延时1秒复位

事件时间线:    放料  转90°  检测2s  转90°  等料芯  装配1s  转180°  到原点
```

---

## IO 状态监控表

### 自检阶段

| 步骤 | Q4.0(CP) | Q4.1(DIR) | I10.0(原点) | 说明 |
|------|----------|-----------|-------------|------|
| 1-正转 | ON | 0(正) | - | 正转5秒 |
| 2-反转 | ON | 1(反) | 等待ON | 反转直到原点 |
| 3-完成 | OFF | - | ON | 自检结束 |

### 主流程阶段

| 步骤 | Q4.0(CP) | Q4.1(DIR) | Q4.2(固定) | Q4.3(推料) | Q4.4(压料) |
|------|----------|-----------|------------|------------|------------|
| 10-等待放料 | OFF | - | OFF | OFF | OFF |
| 20-转到检测 | ON | 0(正) | ON | OFF | OFF |
| 30-检测中 | OFF | - | ON | OFF | OFF |
| 40-转到装配 | ON | 0(正) | ON | OFF | OFF |
| 50-等待料芯 | OFF | - | ON | OFF | OFF |
| 60-装配 | OFF | - | ON | ON | ON |
| 70-回原点 | ON | 0(正) | ON | OFF | OFF |
| 80-有芯回原点 | ON | 0(正) | ON | OFF | OFF |
| 90-完成 | OFF | - | OFF | OFF | OFF |

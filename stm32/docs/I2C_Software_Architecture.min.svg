<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg"><rect width="100%" height="100%" fill="#fff"/><text x="400" y="30" font-family="sans-serif" font-size="20" font-weight="bold" text-anchor="middle" fill="#333">STM32 软件 I2C 架构分层图</text><g transform="translate(200 60)"><rect width="300" height="60" rx="10" ry="10" fill="#dae8fc" stroke="#6c8ebf" stroke-width="2"/><text x="150" y="25" font-family="sans-serif" font-size="14" font-weight="bold" text-anchor="middle">应用层 (main.c)</text><text x="150" y="45" font-family="sans-serif" font-size="12" text-anchor="middle" fill="#333">业务逻辑：我要看加速度数据！</text></g><text x="520" y="95" font-family="sans-serif" font-size="12" fill="#666">调用 MPU6050_GetData(&amp;ACC, ...)</text><defs><marker id="prefix__a" markerWidth="10" markerHeight="10" refX="0" refY="3" orient="auto" markerUnits="strokeWidth"><path d="M0 0v6l9-3z" fill="#666"/></marker></defs><path stroke="#666" stroke-width="2" marker-end="url(#prefix__a)" d="M350 120v30"/><g transform="translate(200 150)"><rect width="300" height="80" rx="10" ry="10" fill="#d5e8d4" stroke="#82b366" stroke-width="2"/><text x="150" y="25" font-family="sans-serif" font-size="14" font-weight="bold" text-anchor="middle">设备驱动层 (MPU6050.c)</text><text x="150" y="45" font-family="sans-serif" font-size="12" text-anchor="middle" fill="#333">翻译官：读写寄存器逻辑</text><text x="150" y="65" font-family="sans-serif" font-size="10" text-anchor="middle" fill="#555">(Start -&gt; Addr -&gt; Reg -&gt; Data -&gt; Stop)</text></g><text x="520" y="180" font-family="sans-serif" font-size="12" fill="#666">1. 发设备地址 (0xD0)</text><text x="520" y="200" font-family="sans-serif" font-size="12" fill="#666">2. 发寄存器地址 (0x3B)</text><text x="520" y="220" font-family="sans-serif" font-size="12" fill="#666">3. 拼接高低位数据</text><path stroke="#666" stroke-width="2" marker-end="url(#prefix__a)" d="M350 230v40"/><g transform="translate(200 270)"><rect width="300" height="80" rx="10" ry="10" fill="#ffe6cc" stroke="#d79b00" stroke-width="2"/><text x="150" y="25" font-family="sans-serif" font-size="14" font-weight="bold" text-anchor="middle">软件协议层 (MyI2C.c)</text><text x="150" y="45" font-family="sans-serif" font-size="12" text-anchor="middle" fill="#333">画师：模拟时序波形</text><text x="150" y="65" font-family="sans-serif" font-size="10" text-anchor="middle" fill="#555">(Start, Stop, SendByte, ReceiveAck)</text></g><text x="520" y="300" font-family="sans-serif" font-size="12" fill="#666">SCL: 拉高 / 拉低</text><text x="520" y="320" font-family="sans-serif" font-size="12" fill="#666">SDA: 输出 0 / 1</text><text x="520" y="340" font-family="sans-serif" font-size="12" fill="#666">Delay: 10us (控制速率)</text><path stroke="#666" stroke-width="2" marker-end="url(#prefix__a)" d="M350 350v40"/><g transform="translate(200 390)"><rect width="300" height="60" rx="10" ry="10" fill="#f8cecc" stroke="#b85450" stroke-width="2"/><text x="150" y="25" font-family="sans-serif" font-size="14" font-weight="bold" text-anchor="middle">物理引脚层 (GPIO)</text><text x="150" y="45" font-family="sans-serif" font-size="12" text-anchor="middle" fill="#333">PB10 (SCL) | PB11 (SDA)</text></g><text x="520" y="415" font-family="sans-serif" font-size="12" font-weight="bold" fill="#c00">重点配置：开漏输出 (OD)</text><text x="520" y="435" font-family="sans-serif" font-size="12" fill="#666">输出1 = 高阻态 (靠上拉电阻)</text><text x="520" y="455" font-family="sans-serif" font-size="12" fill="#666">输出0 = 强下拉接 GND</text><path stroke="#666" stroke-width="2" stroke-dasharray="5 5" marker-end="url(#prefix__a)" marker-start="url(#prefix__a)" d="M350 450v40"/><g transform="translate(200 490)"><rect width="300" height="60" rx="0" ry="0" fill="#e1d5e7" stroke="#9673a6" stroke-width="2"/><text x="150" y="35" font-family="sans-serif" font-size="16" font-weight="bold" text-anchor="middle">MPU6050 传感器</text></g></svg>
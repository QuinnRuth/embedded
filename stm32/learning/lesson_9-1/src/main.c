/* ========== 文件说明 ========== */
// 本程序演示 STM32 通过 USART1 发送各种格式的数据
// 学习目标：
// 1. 掌握串口发送字节、数组、字符串、数字的方法
// 2. 理解 printf 重定向的 3 种实现方式
// 3. 了解串口通信的基本原理（异步、波特率、起始/停止位）
/* ============================== */

#include "stm32f10x.h"                  // Device header
#include "Delay.h"
#include "OLED.h"
#include "Serial.h"

int main(void)
{
	/* ========== 初始化模块 ========== */
	OLED_Init();					// OLED 显示屏初始化（本课未使用，可用于调试）
	Serial_Init();					// 串口初始化：配置 PA9(TX) 为 9600 波特率发送模式
	
	/* ========== 演示 1：发送单字节 ========== */
	// 功能：发送一个原始字节数据
	// 输出：0x41（即 ASCII 字符 'A'）
	Serial_SendByte(0x41);
	
	/* ========== 演示 2：发送数组 ========== */
	// 功能：批量发送多个字节
	// 输出：0x42 0x43 0x44 0x45（即 ASCII 字符 "BCDE"）
	uint8_t MyArray[] = {0x42, 0x43, 0x44, 0x45};
	Serial_SendArray(MyArray, 4);
	
	/* ========== 演示 3：发送字符串 ========== */
	// 功能：发送以 '\0' 结尾的字符串
	// 输出：回车换行符 + "Num1="
	// 说明：\r 为回车符（CR），\n 为换行符（LF），Windows 串口助手需要 \r\n
	Serial_SendString("\r\nNum1=");
	
	/* ========== 演示 4：发送数字（转ASCII）========== */
	// 功能：将无符号整数转为 ASCII 字符串发送
	// 参数：111 为要发送的数字，3 为固定显示 3 位（如 111 显示为 "111"，1 显示为 "001"）
	// 输出："111"
	Serial_SendNumber(111, 3);
	
	/* ========== 演示 5：格式化输出（方法 1）========== */
	// 【方法 1：全局 printf 重定向】
	// 原理：重定向标准 C 库的 fputc() 函数到串口
	// 优点：直接使用 printf()，代码简洁
	// 缺点：只能输出到一个串口，不适合多串口或需要分流的场景
	// 要求：
	//   1. 实现 fputc() 函数（见 Serial.c 第 112 行）
	//   2. 工程选项勾选 "Use MicroLIB"（Keil）或链接参数添加 --specs=nano.specs（GCC）
	printf("\r\nNum2=%d", 222);
	
	/* ========== 演示 6：格式化输出（方法 2）========== */
	// 【方法 2：sprintf + Serial_SendString】
	// 原理：先用 sprintf() 格式化到字符数组，再通过串口发送字符数组
	// 优点：灵活性高，可同时向多个设备发送（如串口、SD卡、网络）
	// 缺点：需要手动分两步操作
	char String[100];					// 定义缓冲区（注意防止溢出！）
	sprintf(String, "\r\nNum3=%d", 333);	// 格式化字符串到 String 数组
	Serial_SendString(String);			// 发送数组内容
	
	/* ========== 演示 7：格式化输出（方法 3）========== */
	// 【方法 3：封装的 Serial_Printf】
	// 原理：将方法 2 封装成函数，内部使用 va_list（可变参数列表）
	// 优点：
	//   1. 兼具 printf 的简洁和 sprintf 的灵活
	//   2. 可多处同时使用，互不干扰
	//   3. 推荐在实际项目中使用
	// 实现：见 Serial.c 第 124 行的 Serial_Printf() 函数
	Serial_Printf("\r\nNum4=%d", 444);
	Serial_Printf("\r\n");
	
	/* ========== 主循环（空闲）========== */
	// 本程序只在初始化时发送一次数据，之后进入空闲循环
	// 实际应用中，可在此循环中定期发送传感器数据或状态信息
	while (1)
	{
		// 空循环：等待中断或其他事件
	}
}
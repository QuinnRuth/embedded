# STM32 课程学习指引

> 一份给初学者的实用学习指南，帮助你快速找到方向

---

## 📋 学习路线图

```
┌─────────────────────────────────────────────────────────────────────┐
│                        STM32 学习路线                              │
├─────────────────────────────────────────────────────────────────────┤
│                                                                 │
│   基础阶段                                                      │
│   ├─ 第2章：GPIO基础          ───► 点灯、理解GPIO模式            │
│   ├─ 第3章：按键 + OLED         ───► 输入检测、数据显示           │
│   │                                                                 │
│   中级阶段                                                       │
│   ├─ 第5章：外部中断          ───► 传感器计次、编码器             │
│   ├─ 第6章：定时器 Timer        ───► 定时中断、PWM、输入捕获        │
│   ├─ 第7章：ADC模数转换        ───► 模拟信号采集                  │
│   ├─ 第8章：DMA               ───► 自动数据传输                  │
│   └─ 第9章：串口通信 USART     ───► 与电脑/其他设备通信            │
│                                                                 │
│   高级阶段                                                       │
│   ├─ 第10章：I2C通信          ───► MPU6050姿态传感器             │
│   ├─ 第11章：SPI通信          ───► W25Q64外部Flash              │
│   ├─ 第12章：备份寄存器与RTC   ───► 数据持久化、实时时钟          │
│   ├─ 第13章：低功耗模式        ───► 电池供电场景                 │
│   ├─ 第14章：看门狗            ───► 系统可靠性                   │
│   └─ 第15章：内部FLASH        ───► 数据存储                     │
│                                                                 │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 🎯 每章学习目标

### 第2章：GPIO基础
**目标**：理解STM32的基本输入输出

| 课程 | 关键概念 | 课后验收 |
|-----|---------|---------|
| 2-1 点灯 | GPIO初始化、输出模式 | 能点亮LED |

**必看文件**：`src/main.c`
```
GPIO_Init(..., GPIO_Mode_Out_PP);  // 推挽输出 → 点灯
```

---

### 第3章：按键 + OLED
**目标**：掌握输入检测和数据显示

| 课程 | 关键概念 | 课后验收 |
|-----|---------|---------|
| 3-1 LED闪烁 | GPIO输出、延时 | 能控制LED亮灭 |
| 3-2 LED流水灯 | 数组、循环 | 能跑马灯 |
| 3-3 OLED演示 | OLED显示API | 能显示字符、数字 |

**必看文件**：`src/main_oled_demo.c`
```c
OLED_ShowString(1, 1, "Hello");  // 显示字符串
OLED_ShowNum(2, 1, 123, 3);    // 显示数字
```

**⚠️ 重要**：3-3 的 OLED API 是后续所有课程的基础，学完之后可以跳过！

---

### 第5章：外部中断
**目标**：掌握传感器信号检测和计次

| 课程 | 关键概念 | 课后验收 |
|-----|---------|---------|
| 5-1 红外传感器 | EXTI中断、中断服务函数 | 能检测遮挡次数 |
| 5-2 旋转编码器 | 双相中断、方向检测 | 能区分顺时针/逆时针 |

**必看文件**：`src/CountSensor.c`, `src/Encoder.c`
```c
void EXTI15_10_IRQHandler(void)
{
    // 中断标志位检测
    if (EXTI_GetITStatus(EXTI_Line14) == SET)
    {
        CountSensor_Count++;  // 计数
        EXTI_ClearITPendingBit(EXTI_Line14);  // 清除标志（关键！）
    }
}
```

---

### 第6章：定时器 Timer 【核心章节】
**目标**：掌握定时器、PWM、输入捕获

| 课程 | 关键概念 | 课后验收 |
|-----|---------|---------|
| 6-1 定时中断 | TIM定时器、中断 | 能定时更新变量 |
| 6-2 外部时钟 | 定时器外部计数 | 能对外部脉冲计数 |
| 6-3 PWM呼吸灯 | PWM输出、占空比 | 能调节LED亮度 |
| 6-4 PWM舵机 | PWM角度控制 | 能控制舵机转动 |
| 6-5 PWM电机 | PWM速度控制 | 能控制电机转速 |
| 6-6 输入捕获 | IC模式、测频率 | 能测量信号频率 |
| 6-7 PWMI模式 | PWMI、测占空比 | 能测量占空比 |
| 6-8 编码器接口 | 硬件编码器模式 | 高速测速 |

**必看文件**：`src/Timer.c`, `src/PWM.c`, `src/IC.c`
```c
// 定时器中断
void TIM2_IRQHandler(void)
{
    if (TIM_GetITStatus(TIM2, TIM_IT_Update) == SET)
    {
        Number++;  // 定时器溢出计数
        TIM_ClearITPendingBit(TIM2, TIM_IT_Update);
    }
}

// PWM 输出
TIM_SetCompare1(TIM2, Compare);  // 设置占空比
```

---

### 第7章：ADC模数转换
**目标**：采集模拟信号

| 课程 | 关键概念 | 课后验收 |
|-----|---------|---------|
| 7-1 AD单通道 | ADC初始化、软件触发 | 能读取电位器值 |
| 7-2 AD多通道 | 扫描模式、DMA配合 | 能读取多路信号 |

**必看文件**：`src/AD.c`
```c
uint16_t AD_GetValue(uint8_t ADC_Channel)
{
    ADC_RegularChannelConfig(ADC1, ADC_Channel, 1, ADC_SampleTime_55Cycles5);
    ADC_SoftwareStartConvCmd(ADC1, ENABLE);  // 软件触发
    while (ADC_GetFlagStatus(ADC1, ADC_FLAG_EOC) == RESET);  // 等待完成
    return ADC_GetConversionValue(ADC1);
}
```

---

### 第8章：DMA
**目标**：自动数据传输，解放CPU

| 课程 | 关键概念 | 课后验收 |
|-----|---------|---------|
| 8-1 DMA数据转运 | DMA配置、自动传输 | 能自动搬运数据 |
| 8-2 DMA+AD多通道 | DMA+ADC配合 | 能自动采集多路AD |

**必看文件**：`src/MyDMA.c`
```c
void DMA_Transfer(DMA_Channel_TypeDef* DMA_Channel, uint32_t SrcAddr,
                uint32_t DstAddr, uint16_t Size)
{
    DMA_Cmd(DMA_Channel, DISABLE);
    DMA_SetCurrDataCounter(DMA_Channel, Size);
    DMA_Cmd(DMA_Channel, ENABLE);  // 启动自动传输
}
```

---

### 第9章：串口通信 USART 【必学】
**目标**：与电脑/其他设备通信

| 课程 | 关键概念 | 课后验收 |
|-----|---------|---------|
| 9-1 串口发送 | USART初始化、发送函数 | 能向电脑发送数据 |
| 9-2 串口收发 | 接收中断 | 能双向通信 |
| 9-3 HEX数据包 | 协议设计 | 能按协议收发数据 |
| 9-4 文本数据包 | 字符串协议 | 能发送命令控制 |

**必看文件**：`src/Serial.c`
```c
void Serial_SendByte(uint8_t Byte)
{
    USART_SendData(USART1, Byte);
    while (USART_GetFlagStatus(USART1, USART_FLAG_TXE) == RESET);
}

// 接收中断
void USART1_IRQHandler(void)
{
    if (USART_GetITStatus(USART1, USART_IT_RXNE) == SET)
    {
        RxData = USART_ReceiveData(USART1);
        // 处理接收数据
    }
}
```

---

### 第10-11章：I2C/SPI通信
**目标**：连接传感器和外部存储

| 章节 | 外设 | 关键概念 | 课后验收 |
|-----|-----|---------|---------|
| 10 | I2C | MPU6050、软件I2C时序 | 能读取加速度/陀螺仪 |
| 11 | SPI | W25Q64、软件SPI时序 | 能读写外部Flash |

---

### 第12-15章：系统功能
**目标**：掌握更高级的系统功能

| 章节 | 关键概念 | 应用场景 |
|-----|---------|---------|
| 12 备份寄存器与RTC | 掉电数据保存、实时时钟 | 保存设置、电子钟 |
| 13 低功耗模式 | 睡眠、停止、待机 | 电池供电设备 |
| 14 看门狗 | 独立看门狗、窗口看门狗 | 提高系统可靠性 |
| 15 内部FLASH | Flash读写 | 用户数据存储 |

---

## 🔍 代码阅读技巧

### 第一步：先看 main.c，理解程序做什么

```c
int main(void)
{
    // 1. 初始化各模块
    OLED_Init();
    Timer_Init();

    // 2. 显示初始信息
    OLED_ShowString(1, 1, "Num:");

    // 3. 主循环
    while (1)
    {
        OLED_ShowNum(2, 1, Number, 5);  // 显示计数
    }
}
```

**问题清单**：
- 程序初始化了哪些模块？
- 主循环里在做什么？
- 显示什么？控制什么？

---

### 第二步：看外设模块，理解怎么配置

```c
void Timer_Init(void)
{
    RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM2, ENABLE);  // 开时钟

    TIM_TimeBaseInitTypeDef TIM_TimeBaseInitStruct;
    TIM_TimeBaseInitStruct.TIM_Period = 10000 - 1;        // 自动重装值
    TIM_TimeBaseInitStruct.TIM_Prescaler = 7200 - 1;      // 预分频
    TIM_TimeBaseInitStruct.TIM_ClockDivision = TIM_CKD_DIV1;
    TIM_TimeBaseInitStruct.TIM_CounterMode = TIM_CounterMode_Up;
    TIM_TimeBaseInit(TIM2, &TIM_TimeBaseInitStruct);

    TIM_ITConfig(TIM2, TIM_IT_Update, ENABLE);            // 开启更新中断
    TIM_Cmd(TIM2, ENABLE);                                 // 启动定时器
}
```

**问题清单**：
- 开了哪些时钟？
- 外设的核心参数是什么（周期、分频）？
- 是否开启了中断？中断优先级是多少？
- GPIO配置成什么模式？

---

### 第三步：看中断函数（如果有）

```c
void TIM2_IRQHandler(void)
{
    if (TIM_GetITStatus(TIM2, TIM_IT_Update) == SET)
    {
        Number++;  // 业务逻辑

        TIM_ClearITPendingBit(TIM2, TIM_IT_Update);  // 清除标志位（关键！）
    }
}
```

**问题清单**：
- 中断触发条件是什么？
- 中断里做了什么（更新变量、发送数据等）？
- 是否清除了中断标志位？

---

## 📁 代码文件定位速查

| 你想找什么 | 打开文件 |
|----------|---------|
| **程序入口/业务逻辑** | `src/main*.c` |
| **外设初始化配置** | `src/<外设模块>.c` 中的 `xxx_Init()` |
| **中断服务函数** | 搜索 `xxx_IRQHandler` |
| **外设API接口** | `include/<外设模块>.h` |
| **当前用哪个main** | `CMakeLists.txt` 中的 `MAIN_SRC` |
| **OLED显示API** | `src/OLED.c` 或 `include/OLED.h` |

---

## ⚙️ 构建烧录命令

```bash
# 进入课程目录
cd stm32/learning/lesson_X-X

# 配置（首次或切换功能）
cmake -S . -B build \
    -DCMAKE_TOOLCHAIN_FILE=cmake/toolchains/arm-gcc.cmake \
    -DBOARD=stm32f103c8t6 \
    -DAPP=<程序名> \
    -G Ninja

# 编译
cmake --build build

# 烧录
echo "zxcvbnm" | sudo -S openocd -f boards/stm32f103c8t6/openocd.cfg \
    -c "program build/firmware.elf verify reset exit"
```

---

## 💡 学习建议

### 初学者路线（推荐）

```
第2章 (GPIO) → 第3章 (OLED) → 第5章 (中断)
     ↓
第6章 (定时器) → 第7章 (ADC) → 第9章 (串口)
     ↓
第8章 (DMA) → 第10章 (I2C) → 第11章 (SPI)
     ↓
第12-15章 (系统功能)
```

### 按需学习路线

**想做传感器项目**：5-1/5-2 → 7-1 → 9-2 → 10-1/11-1

**想做电机控制**：6-3 → 6-4 → 6-5 → 6-8

**想做通信项目**：9-1 → 9-2 → 9-3/9-4 → 8-1

**想做低功耗**：5-1 → 6-1 → 13-2/13-3/13-4

---

## 📝 每课学习检查清单

学完一课后，问自己：

- [ ] 知道这个程序在做什么吗？
- [ ] 知道外设是怎么初始化的吗？
- [ ] 知道中断函数里做了什么吗？
- [ ] 能用自己的话解释关键代码吗？
- [ ] 能修改参数实现不同效果吗？

---

## 🚨 常见问题

**Q: 为什么有些文件不用看？**

A: `Delay.c`、`OLED.c` 是通用模块，学一次就够。`drivers/` 是官方库，不需要看。

**Q: 怎么知道当前编译的是哪个 main.c？**

A: 看 `CMakeLists.txt` 里的 `MAIN_SRC` 变量。

**Q: 中断标志位一定要清除吗？**

A: 一定要！否则中断会无限触发，程序卡死。

**Q: GPIO上拉/下拉有什么用？**

A: 保证引脚在悬空时有确定的电平，避免误触发。

**Q: PWM占空比是什么？**

A: 高电平时间占整个周期的比例。50%占空比 = 一半高电平一半低电平。

---

## 📚 参考资源

| 资源 | 路径 |
|-----|------|
| 课程规划 | `COURSE_BUILD_PLAN.md` |
| 数据手册 | `课件/参考资料/STM32F103C8T6数据手册.pdf` |
| 参考手册 | `课件/参考资料/STM32F10xxx参考手册(中文).pdf` |
| 程序源码 | `课件/程序源码/程序源码/STM32Project-有注释版/` |
| 概念文档 | `stm32/docs/concepts/` |

---

**祝你学习顺利！有问题就动手试，代码改了烧了看效果，这就是最好的学习方式。** 🎓
